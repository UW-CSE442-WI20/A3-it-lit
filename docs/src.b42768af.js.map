{"version":3,"sources":["index.js"],"names":["diameter","pad","ages","colors","scale","d3","scaleSqrt","svg","select","append","attr","pack","size","padding","getFilteredData","data","intent","ageGroup","filter","d","Age","Intent","csvFile","require","enterCircles","nestedData","nest","key","Race","rollup","sum","Rate","entries","root","hierarchy","children","value","maxValue","getMaxValue","domain","range","length","node","selectAll","leaves","enter","i","x","y","text","transition","duration","style","toFixed","self","frameElement","updateCircles","call","currMax","Math","max","csv","Deaths","Population","parseFloat","then","$intentSelector","document","getElementById","sliderAge","sliderBottom","min","width","ticks","step","default","on","val","onchange","e","target"],"mappings":"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","file":"src.b42768af.js","sourceRoot":"../src","sourcesContent":["// define functions for handling homicide & side-annotation\n\n// suicide & side-annotation\n\ndiameter = 500;\npad = 5;\nvar ages = [\"All\", \"Under 15\", \"15 - 34\", \"35 - 64\", \"65+\"];\nvar colors = [\"#A6ACAF\", \"#52BE80\", \"#E67E22\", \"#5DADE2\", \"#E74C3C\", \"#2471A3\"]\nvar scale = d3.scaleSqrt();\nvar svg = d3.select(\"body\").append(\"svg\");\nsvg.attr(\"width\", diameter).attr(\"height\", diameter).attr(\"border\", 0);\n\nvar pack = d3.pack()\n    .size([diameter-50, diameter])\n    .padding(pad);\n\nfunction getFilteredData(data, intent, ageGroup) {\n  if (intent == 1 && ageGroup == 0) { // double equals allows interpolation\n    // both homicide and suicide\n    return data;\n  } else if (intent == 1) {\n    return data.filter(function(d) { return d.Age === ages[ageGroup] });\n  } else if (intent == 2 && ageGroup == 0) {\n    // homicide\n    return data.filter(function(d) { return d.Intent === \"Homicide\"});\n  } else if (intent == 2) {\n    return data.filter(function(d) { return (d.Intent === \"Homicide\") && (d.Age === ages[ageGroup])});\n  } else if (intent == 3 && ageGroup == 0){\n    // suicide\n    return data.filter(function(d) { return d.Intent === \"Suicide\"});\n  } else {\n    return data.filter(function(d) { return (d.Intent === \"Suicide\") && (d.Age === ages[ageGroup])});\n  }\n}\n\n// read in CSV data\nconst csvFile = require(\"./fullData.csv\");\nd3.csv(csvFile, function(d) {\n        d.Deaths = +d.Deaths;\n        d.Population = +d.Population;\n        d.Rate = parseFloat(d.Rate);\n        return d;\n}).then(function(d) {\n    var $intentSelector = document.getElementById(\"intent-select\");\n    var intent = $intentSelector.value;\n    var ageGroup = 0;\n    var intentData = getFilteredData(d, $intentSelector.value, ageGroup);\n\n    enterCircles(intentData);\n\n    var sliderAge = d3\n        .sliderBottom()\n        .min(0)  // bind based on 0-4 on the call, filter\n        .max(4)\n        .width(300)\n        .ticks(4)\n        .step(1)\n        .default(0)\n        .on('onchange', val => {\n            d3.select('p#value-age').text((ages[val]));\n            ageGroup = val;\n            var ageData = getFilteredData(d, intent, ageGroup);\n            updateCircles(ageData);\n        });\n\n    var gAge = d3\n        .select('div#slider-age')\n        .append('svg')\n        .attr('width', 500)\n        .attr('height', 100)\n        .append('g')\n        .attr('transform', 'translate(30,30)');\n\n    gAge.call(sliderAge);\n\n    d3.select('p#value-age').text((ages[sliderAge.value()]));\n\n    $intentSelector.onchange = function(e) {\n      intent = e.target.value;\n      var intentData = getFilteredData(d, intent, ageGroup);\n\n\n      updateCircles(intentData);\n\n    };\n})\n\n// hard cap @ 6 circles, so hard math was performed on rendering\n// hard padding @ 50 on each side, so actual svg is 500x500\nfunction enterCircles(data) {\n\n  var nestedData = d3.nest()\n    .key(function(d) { return d.Race;})\n    .rollup(function(d) {\n      return d3.sum(d, function(d) {\n        return d.Rate;  // deaths per 100k\n      })\n    })\n    .entries(data);\n\n  var root = d3.hierarchy({children: nestedData})\n    .sum(function(d) { return d.value; });\n\n  var maxValue = getMaxValue(nestedData);\n\n  scale.domain([0, maxValue])\n    .range([20, (diameter) / nestedData.length]);\n\n  var node = svg.selectAll(\".node\")\n  .data(pack(root).leaves())\n  .enter()\n  .append(\"g\")\n  .attr(\"class\", \"node\")\n  .attr(\"transform\", function(d, i) {\n    return \"translate(\" + d.x + \", \" + d.y + \")\";\n  });\n\n  node.append(\"title\")\n    .text(function(d, i) {\n      return d.key + \": \" + d.value;\n    });\n\n  node.append(\"circle\")\n    .transition()\n    .duration(1000)\n    .attr(\"r\", function(d, i) {\n        return scale(d.value);\n    })\n    .attr(\"stroke\", \"black\")\n    .style(\"fill\", function(d,i) {\n        return colors[i];\n    });\n\n  node.append(\"text\")\n    .attr(\"dy\", \".2em\")\n    .style(\"text-anchor\", \"middle\")\n    .text(function(d) {\n        return d.data.key;\n    })\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-size\", function(d){\n        return scale(d.value)/5;\n    })\n    .attr(\"fill\", \"white\");\n\n  node.append(\"text\")\n    .attr(\"dy\", \"1.3em\")\n    .attr(\"class\", \"subtitle\")\n    .style(\"text-anchor\", \"middle\")\n    .text(function(d) {\n        return d.value.toFixed(2);\n    })\n    .attr(\"font-family\",  \"Gill Sans\", \"Gill Sans MT\")\n    .attr(\"font-size\", function(d){\n        return scale(d.value)/5;\n    })\n    .attr(\"fill\", \"white\");\n\n  d3.select(self.frameElement)\n    .style(\"height\", diameter + \"px\");\n\n  }\n\nfunction updateCircles(data) {\n\n  var nestedData = d3.nest()\n  .key(function(d) { return d.Race;})\n  .rollup(function(d) {\n    return d3.sum(d, function(d) {\n      return d.Rate;  // deaths per 100k to 2 decimals\n    })\n  })\n  .entries(data);\n\nvar root = d3.hierarchy({children: nestedData})\n  .sum(function(d) { return d.value; })\nvar maxValue = getMaxValue(nestedData);\n\nscale.domain([0, maxValue])\n  .range([20, (diameter) / nestedData.length]);\n\n  var node = svg.selectAll(\".node\")\n  .data(pack(root).leaves())\n  .transition()\n  .duration(2000)\n  .attr(\"transform\", function(d, i) {\n    return \"translate(\" + d.x + \", \" + d.y+ \")\";\n  })\n  .call(function(node) {\n    node.select(\"circle\")\n    .attr(\"r\", function(d, i) {\n        return scale(d.value);\n    });\n\n    node.select(\"text\")\n    .attr(\"dy\", \".2em\")\n    .style(\"text-anchor\", \"middle\")\n    .text(function(d) {\n        return d.data.key;\n    })\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-size\", function(d){\n        return scale(d.value)/5;\n    })\n    .attr(\"fill\", \"white\");\n\n    node.select(\".subtitle\")\n    .attr(\"dy\", \"1.3em\")\n    .style(\"text-anchor\", \"middle\")\n    .text(function(d) {\n        return d.value.toFixed(2);\n    })\n    .attr(\"font-family\",  \"Gill Sans\", \"Gill Sans MT\")\n    .attr(\"font-size\", function(d){\n        return scale(d.value)/5;\n    })\n    .attr(\"fill\", \"white\");\n\n    d3.select(self.frameElement)\n    .style(\"height\", diameter + \"px\");\n  });\n\n\n\n\n}\n\nfunction getMaxValue(d) {\n  var currMax = d[0].value;\n  for (var i = 1; i < d.length; i++) {\n    currMax = Math.max(currMax, d[i].value);\n  }\n  return currMax;\n}\n"]}