{"version":3,"sources":["index.js"],"names":["diameter","pad","ages","scale","d3","scaleSqrt","svg","select","append","attr","pack","size","padding","getFilteredData","data","intent","ageGroup","console","log","filter","d","Age","Intent","csvFile","require","enterCircles","nestedData","nest","key","Race","rollup","sum","Math","round","Rate","entries","root","hierarchy","children","value","maxValue","getMaxValue","domain","range","length","node","selectAll","leaves","enter","i","x","y","text","transition","duration","style","getRandomColor","toFixed","self","frameElement","exitCircles","remove","updateCircles","call","letters","color","floor","random","currMax","max","csv","Deaths","Population","parseFloat","then","$intentSelector","document","getElementById","sliderAge","sliderBottom","min","width","ticks","step","default","on","val","ageData","onchange","e","target","intentData"],"mappings":"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","file":"src.2b31a49f.js","sourceRoot":"../src","sourcesContent":["// define functions for handling homicide & side-annotation\n\n// suicide & side-annotation\n\ndiameter = 600;\npad = 5;\nvar ages = [\"All\", \"Under 15\", \"15 - 34\", \"35 - 64\", \"65+\"];\nvar scale = d3.scaleSqrt();\nvar svg = d3.select(\"body\").append(\"svg\");\nsvg.attr(\"width\", diameter).attr(\"height\", diameter);\n\nvar pack = d3.pack()\n    .size([diameter-50, diameter])\n    .padding(pad);\n\nfunction getFilteredData(data, intent, ageGroup) {\n  console.log(intent);\n  if (intent == 1 && ageGroup == 0) { // double equals allows interpolation\n    // both homicide and suicide\n    return data;\n  } else if (intent == 1) {\n    return data.filter(function(d) { return d.Age === ages[ageGroup] });\n  } else if (intent == 2 && ageGroup == 0) {\n    // homicide\n    return data.filter(function(d) { return d.Intent === \"Homicide\"});\n  } else if (intent == 2) {\n    return data.filter(function(d) { return (d.Intent === \"Homicide\") && (d.Age === ages[ageGroup])});\n  } else if (intent == 3 && ageGroup == 0){\n    // suicide\n    return data.filter(function(d) { return d.Intent === \"Suicide\"});\n  } else {\n    return data.filter(function(d) { return (d.Intent === \"Suicide\") && (d.Age === ages[ageGroup])});\n  }\n}\n\n// read in CSV data\nconst csvFile = require(\"./fullData.csv\");\nd3.csv(csvFile, function(d) {\n        d.Deaths = +d.Deaths;\n        d.Population = +d.Population;\n        d.Rate = parseFloat(d.Rate);\n        return d;\n}).then(function(d) {\n    var $intentSelector = document.getElementById(\"intent-select\");\n    var intent = $intentSelector.value;\n    var ageGroup = 0;\n    var intentData = getFilteredData(d, $intentSelector.value, ageGroup);\n\n    enterCircles(intentData);\n\n    var sliderAge = d3\n        .sliderBottom()\n        .min(0)  // bind based on 0-4 on the call, filter\n        .max(4)\n        .width(300)\n        .ticks(4)\n        .step(1)\n        .default(0)\n        .on('onchange', val => {\n            d3.select('p#value-age').text((ages[val]));\n            ageGroup = val;\n            var ageData = getFilteredData(d, intent, ageGroup);\n            updateCircles(ageData);\n            enterCircles(ageData);\n        });\n\n    var gAge = d3\n        .select('div#slider-age')\n        .append('svg')\n        .attr('width', 500)\n        .attr('height', 100)\n        .append('g')\n        .attr('transform', 'translate(30,30)');\n\n    gAge.call(sliderAge);\n\n    d3.select('p#value-age').text((ages[sliderAge.value()]));\n\n    $intentSelector.onchange = function(e) {\n      console.log($intentSelector.value);\n      intent = e.target.value;\n      var intentData = getFilteredData(d, intent, ageGroup);\n\n\n      updateCircles(intentData);\n      //exitCircles(intentData);\n      enterCircles(intentData);\n\n    };\n})\n\n// hard cap @ 6 circles, so hard math was performed on rendering\n// hard padding @ 50 on each side, so actual svg is 500x500\nfunction enterCircles(data) {\n  // scale.domain([0, d3.max(data, function(d) { return d.Deaths; })])\n  //     .range([0, d3.max(data, function(d) { return d.Rate; })]); // idk\n\n  var nestedData = d3.nest()\n    .key(function(d) { return d.Race;})\n    .rollup(function(d) {\n      return d3.sum(d, function(d) {\n        return Math.round(d.Rate);  // deaths per 100k\n      })\n    })\n    .entries(data);\n\n  var root = d3.hierarchy({children: nestedData})\n    .sum(function(d) { return d.value; })\n\n  var maxValue = getMaxValue(nestedData);\n\n  scale.domain([0, maxValue])\n    .range([20, (diameter) / nestedData.length]);\n\n  console.log(nestedData);\n\n  var node = svg.selectAll(\".node\")\n  .data(pack(root).leaves())\n  .enter()\n  .append(\"g\")\n  .attr(\"class\", \"node\")\n  .attr(\"transform\", function(d, i) {\n    return \"translate(\" + d.x + \", \" + d.y + \")\";\n  });\n\n  node.append(\"title\")\n    .text(function(d, i) {\n      return d.key + \": \" + d.value;\n    });\n\n  node.append(\"circle\")\n    .transition()\n    .duration(1000)\n    .attr(\"r\", function(d, i) {\n        return scale(d.value);\n    })\n    .attr(\"stroke\", \"black\")\n    .style(\"fill\", function(d,i) {\n        return getRandomColor();\n    });\n\n  node.append(\"text\")\n    .attr(\"dy\", \".2em\")\n    .style(\"text-anchor\", \"middle\")\n    .text(function(d) {\n        return d.data.key;\n    })\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-size\", function(d){\n        return scale(d.value)/5;\n    })\n    .attr(\"fill\", \"white\");\n\n  node.append(\"text\")\n    .attr(\"dy\", \"1.3em\")\n    .attr(\"class\", \"subtitle\")\n    .style(\"text-anchor\", \"middle\")\n    .text(function(d) {\n        console.log(d);\n        return d.value.toFixed(2);\n    })\n    .attr(\"font-family\",  \"Gill Sans\", \"Gill Sans MT\")\n    .attr(\"font-size\", function(d){\n        return scale(d.value)/5;\n    })\n    .attr(\"fill\", \"white\");\n\n  d3.select(self.frameElement)\n    .style(\"height\", diameter + \"px\");\n\n  }\n\nfunction exitCircles(data) {\n// svg.selectAll(\"circles\")\n//     .data(data)\n//     .exit()\n//     .remove();\n  svg.selectAll(\"g\")\n  .remove(); // doesn't allow transitions, but deletes properly.\n}\n\nfunction updateCircles(data) {\n\n  var nestedData = d3.nest()\n  .key(function(d) { return d.Race;})\n  .rollup(function(d) {\n    return d3.sum(d, function(d) {\n      return d.Rate;  // deaths per 100k to 2 decimals\n    })\n  })\n  .entries(data);\n\nvar root = d3.hierarchy({children: nestedData})\n  .sum(function(d) { return d.value; })\nvar maxValue = getMaxValue(nestedData);\n\nscale.domain([0, maxValue])\n  .range([20, (diameter) / nestedData.length]);\n\n  var node = svg.selectAll(\".node\")\n  .data(pack(root).leaves())\n  .transition()\n  .duration(2000)\n  .attr(\"transform\", function(d, i) {\n    return \"translate(\" + d.x + \", \" + d.y+ \")\";\n  })\n  .call(function(node) {\n    node.select(\"circle\")\n    .attr(\"r\", function(d, i) {\n        return scale(d.value);\n    });\n\n    node.select(\"text\")\n    .attr(\"dy\", \".2em\")\n    .style(\"text-anchor\", \"middle\")\n    .text(function(d) {\n        return d.data.key;\n    })\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-size\", function(d){\n        return scale(d.value)/5;\n    })\n    .attr(\"fill\", \"white\");\n\n    node.select(\".subtitle\")\n    .attr(\"dy\", \"1.3em\")\n    .style(\"text-anchor\", \"middle\")\n    .text(function(d) {\n        console.log(d);\n        return d.value.toFixed(2);\n    })\n    .attr(\"font-family\",  \"Gill Sans\", \"Gill Sans MT\")\n    .attr(\"font-size\", function(d){\n        return scale(d.value)/5;\n    })\n    .attr(\"fill\", \"white\");\n\n    d3.select(self.frameElement)\n    .style(\"height\", diameter + \"px\");\n  });\n\n\n\n\n}\n\n// differentiation on refresh\nfunction getRandomColor() {\nvar letters = '0123456789ABCDEF';\nvar color = '#';\nfor (var i = 0; i < 6; i++) {\n  color += letters[Math.floor(Math.random() * 16)];\n}\nreturn color;\n}\n\nfunction getMaxValue(d) {\n  var currMax = d[0].value;\n  for (var i = 1; i < d.length; i++) {\n    currMax = Math.max(currMax, d[i].value);\n  }\n  return currMax;\n}\n"]}